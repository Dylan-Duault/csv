#CSV

Laravel 5 package to read and write CSV files.

##Instalation

First run composer command

<code>composer require wilgucki/csv</code>

Next add service provider to <code>config/app.php</code> file

    'providers' => [
        //... 
        Wilgucki\Csv\CsvServiceProvider::class,
    ]

Last step is to add facades to <code>config/app.php</code> file

    'aliases' => [
        //...
        'CsvReader' => Wilgucki\Csv\Facades\Reader::class,
        'CsvWriter' => Wilgucki\Csv\Facades\Writer::class,
    ]

##Usage

###Reader

First you need to open CSV file.

    $reader = CsvReader::open('/path/to/file.csv');

If you need to change delimiter, enclosure or escape you can do it by passing proper values to <code>open</code> method.
More information about these values can be found here - [http://php.net/manual/en/function.fgetcsv.php](http://php.net/manual/en/function.fgetcsv.php).

    $reader = CsvReader::open('/path/to/file.csv', ';', '\'', '\\\\');

Having your CSV file opened you can read it line after line

    while (($line = $reader->readLine()) !== false) {
        print_r($line);
    }

or you could read whole file at once

    print_r($reader->readAll());

If your CSV file contains header line, you can convert it into array keys for each line.

    $reader = CsvReader::open($file, ';');
    $header = $reader->getHeader();
    print_r($header);
    print_r($reader->readAll());

Don't forget to close file after you're done with your work.

    $reader->close();

##Writer

At first you need to create new file
    
    $writer = CsvWriter::create('/path/where/your/file/will/be/saved.csv');

File path is optional. If you won't provide it, CsvWriter will use memory as storege for added content.

If you need to change delimiter, enclosure or escape you can do it by passing proper values to <code>create</code> method.
More information about these values can be found here - [http://php.net/manual/en/function.fputcsv.php](http://php.net/manual/en/function.fputcsv.php).

    $writer = CsvWriter::create('/path/to/file.csv', ';', '\'', '\\\\');

To add data into CSV file you can use <code>writeLine</code> or <code>writeAll</code> methods.

    $writer->writeLine(['some', 'data']);
    $writer->writeLine(['another', 'line']);
    
    $writer->writeAll([
        ['some', 'data'],
        ['another', 'line'],
    ]);

To display data added to CSV file, you can use flush method.

    echo $writer->flush();

Don't forget to close file after you're done with your work.

    $writer->close();

##Intergating with Eloquent models

If you want/need to integrate CsvReader and/or CsvWriter with Eloquent model, there's a simple way to do this.
The Csv package offers three traits in order to simplify the process. You can use all traits as well as one or two of your choise.

**These traits hasn't been tested for relations.**

###CsvCustomCollection

CsvCustomCollection trait added to model class enables <code>toCsv</code> method that can be used on collection.

    use Wilgucki\Csv\Traits\CsvCustomCollection;
    
    class SomeModel extends Model
    {
        use CsvCustomCollection;
        
        //...
    }
    
    $items = SomeModel::all(); // you can use where as well
    $csvData = $items->toCsv();

###CsvExportable

CsvExportable trait allows you to convert single model object to CSV data.

    use Wilgucki\Csv\Traits\CsvExportable;
    
    class SomeModel extends Model
    {
        use CsvExportable;
        
        //...
    }
    
    $csvData = SomeModel::find(1)->toCsv();

###CsvImportable

CsvImportable trait allows you to import data from CSV file and save it to database.
Imported file must have header line containing column names as they are named in database table. Primary key must be named **id**.
CSV importer will update all rows with matching id and add every row that isn't found in table.

    use Wilgucki\Csv\Traits\CsvImportable;
    
    class SomeModel extends Model
    {
        use CsvImportable;
        
        //...
    }
    
    SomeModel::fromCsv('/path/to/file.csv');

##TODO

- tests
- convert encoding (useful when dealing with CSV file generated by Excel)
- import/export to CSV with relations
- set default CSV parametrs in config file